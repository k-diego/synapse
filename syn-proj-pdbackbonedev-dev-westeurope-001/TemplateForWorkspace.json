{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "syn-proj-pdbackbonedev-dev-westeurope-001"
		},
		"LSDatalake_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://stpdbackbonedevdatalake.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/LSDatalake')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('LSDatalake_properties_typeProperties_url')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 8')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'datalake_stpdbackbonedevdatalake_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [datalake_stpdbackbonedevdatalake_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION = 'abfss://datalake@stpdbackbonedevdatalake.dfs.core.windows.net' \n\t)\nGO\n\nCREATE EXTERNAL TABLE MasterBatchRecordData (\n\t[ID] nvarchar(4000),\n\t[Timestamp_DB] nvarchar(4000),\n\t[Timestamp] nvarchar(4000),\n\t[ElapsedBatchRuntime] nvarchar(4000),\n\t[MbrNumber] nvarchar(4000),\n\t[ProductName] nvarchar(4000),\n\t[ProjectNumber] nvarchar(4000),\n\t[RunId] nvarchar(4000),\n\t[ExperimentId] nvarchar(4000),\n\t[DeviceId] nvarchar(4000),\n\t[SoftwareVersion] nvarchar(4000),\n\t[BatchId] nvarchar(4000),\n\t[TimeStampStart] nvarchar(4000),\n\t[MethodPatternId] nvarchar(4000),\n\t[MethodPatternComment] nvarchar(4000),\n\t[OperatorId] nvarchar(4000),\n\t[SupervisorId] nvarchar(4000),\n\t[StartComment] nvarchar(4000),\n\t[RunComment] nvarchar(4000),\n\t[SensorData] nvarchar(4000),\n\t[CPanelVersion] nvarchar(4000),\n\t[TcSolutionVersion] nvarchar(4000),\n\t[TwinCatVersion] nvarchar(4000),\n\t[Run_DbId] nvarchar(4000)\n\t)\n\tWITH (\n\tLOCATION = 'curated/tenant=PrinterCo/server=S-TSLA-DCU-002/db=CureVac DataLogging CUR00011 M02 DNA/table=MasterBatchRecordData/**',\n\tDATA_SOURCE = [datalake_stpdbackbonedevdatalake_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\n\nSELECT TOP 100 * FROM dbo.MasterBatchRecordData\nGO",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/curated')]",
			"type": "Microsoft.Synapse/workspaces/databases",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"Ddls": [
					{
						"ActionType": "CREATE",
						"OldEntity": null,
						"NewEntity": {
							"Name": "curated",
							"EntityType": "DATABASE",
							"Origin": {
								"Type": "SPARK"
							},
							"Properties": {
								"IsSyMSCDMDatabase": true
							},
							"Source": {
								"Provider": "ADLS",
								"Location": "abfss://datalake@stpdbackbonedevdatalake.dfs.core.windows.net/curated",
								"Properties": {
									"FormatType": "parquet",
									"LinkedServiceName": "LSDatalake"
								}
							}
						},
						"Source": {
							"Type": "SPARK"
						}
					}
				]
			},
			"dependsOn": []
		}
	]
}